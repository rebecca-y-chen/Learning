<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1" />
<title>八大行星自轉/公轉</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Chiron+GoRound+TC:wght@200..900&display=swap');
  @font-face {
    font-family: 'zhuyinRound-R';
    src: url('fonts/zhuyinRound-R.ttf') format('truetype');
    font-weight: normal;
    font-style: normal;
  }

  :root{
    --glass-bg: rgba(255,255,255,0.08);
    --glass-brd: rgba(255,255,255,0.2);
    --glass-blur: 18px;
    --cyan: rgba(0,255,255,0.6);
    --shadow: 0 8px 32px rgba(0,0,0,0.4);
  }

  *{ box-sizing: border-box; }
  html, body{ height:100%; }
  body{
    margin:0;
    background: radial-gradient(ellipse at top, #0d1b2a, #000 80%);
    color:#fff;
    font-family:"Chiron GoRound TC", 'zhuyinRound-R', system-ui, sans-serif;
  }

  h1{
    text-align:center;
    margin:60px 0 30px;
    letter-spacing:2px;
    text-shadow:0 0 12px rgba(0,255,255,0.35);
    font-family:'zhuyinRound-R', 'Inter', sans-serif;
  }

  section{
    margin:0 auto;
    max-width:1200px;
    padding:20px;
  }

  h2{
    text-align:center;
    margin:16px 0 8px;
    letter-spacing:2px;
    text-shadow:0 0 8px rgba(0,255,255,0.25);
  }

  .hint{
    text-align:center;
    font-size:13px;
    letter-spacing:0.5px;
    color:#ccc;
    margin-bottom:14px;
  }

  .glass{
    background: var(--glass-bg);
    backdrop-filter: blur(var(--glass-blur));
    -webkit-backdrop-filter: blur(var(--glass-blur));
    border-radius: 16px;
    border: 1px solid var(--glass-brd);
    box-shadow: var(--shadow);
  }

  .row{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:20px;
    margin:20px 0;
    padding:24px;
  }
  .planet{
    flex:1 1 120px;
    max-width:140px;
    text-align:center;
  }
  .planet canvas{
    display:block;
    margin:0 auto;
    border-radius:12px;
    background: #0b1320;
  }
  .planet .name{
    display:block;
    color:#fff;
    text-shadow:0 0 6px var(--cyan);
    font-size:20px;
    margin-top:12px;
    font-weight:700;
    letter-spacing:2px;
  }
  .planet .meta{
    font-size:12px;
    color:#d0d0d0;
    line-height:1.3;
    margin-top:8px;
  }

  .two-col{
    display:flex;
    gap:20px;
    margin:50px auto;
  }
  .col{ flex:1; 
  padding:24px;
  position: relative; /* <-- 新增：設定定位父層 */
}

  canvas{ display:block; margin:0 auto; touch-action: manipulation; }

  .control-group{ margin-top:18px; width:100%; }
  label{ display:block; margin-bottom:6px; font-size:14px; color:#dbe9ff; letter-spacing:1px; }

  input[type=range]{
    -webkit-appearance:none; appearance:none; width:100%; height:14px;
    border-radius:999px; outline:none; background: rgba(255,255,255,0.12);
    box-shadow: inset 0 0 0 1px rgba(255,255,255,0.15), 0 2px 10px rgba(0,0,0,0.35);
    backdrop-filter: blur(10px);
  }
  input[type=range]::-webkit-slider-thumb{
    -webkit-appearance:none; appearance:none; width:22px; height:22px; border-radius:50%;
    background: radial-gradient( circle at 30% 30%, #e9f7ff, #65c1ff 60%, #0094ff );
    box-shadow: 0 4px 10px rgba(0,148,255,0.5), 0 0 0 2px rgba(255,255,255,0.25) inset;
    cursor:pointer;
  }
  input[type=range]::-moz-range-thumb{
    width:22px; height:22px; border:none; border-radius:50%;
    background: radial-gradient( circle at 30% 30%, #e9f7ff, #65c1ff 60%, #0094ff );
    box-shadow: 0 4px 10px rgba(0,148,255,0.5), 0 0 0 2px rgba(255,255,255,0.25) inset;
    cursor:pointer;
  }
  .scale{ display:flex; justify-content:space-between; font-size:12px; margin-top:6px; color:#9fd3ff; }
  .scale span{ text-align:center; width:40px; }
  .info{ margin-top:12px; font-size:14px; text-align:center; line-height:1.5; }

  /* Backdrop（黑幕） */
  #backdrop{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.45);
    z-index:1000;
    display:none;            /* 初始隱藏 */
  }

  /* Tooltip 卡片（z-index 要高於黑幕） */
  #tooltip{
    position: absolute;
    background: rgba(20,20,30,0.95);
    color: #fff;
    padding: 16px 18px;
    border-radius: 12px;
    font-size: 15px;
    line-height: 1.6;
    max-width: 320px;
    display: none;          /* 初始隱藏 */
    box-shadow: 0 0 16px rgba(0,255,255,0.4);
    z-index: 1001;          /* 高於 #backdrop */
  }
  
  #tooltip b{
    display:block; font-size:22px; margin-bottom:8px; letter-spacing:2px;
    text-shadow:0 0 6px var(--cyan);
  }
  #tooltip img{ display:block; width:100%; border-radius:8px; margin:10px 0; }
  #tooltip .desc{
    display:block; background: rgba(0, 128, 255, 0.25); color: #aeefff;
    font-size: 14px; padding: 6px 8px; border-radius: 6px; margin-top:6px;
  }
  #tooltip .btn{
    display:none; /* 手機才會顯示 */
    margin:12px auto 0; padding:8px 14px; border:none; border-radius:8px;
    background:linear-gradient(135deg,#0080ff,#00c6ff);
    color:#fff; font-size:15px; font-weight:600; cursor:pointer;
  }

 @media (max-width: 768px){
    h1{ margin:40px 0 20px; }
    section{
      width:100% !important; max-width:100% !important;
      margin:0 !important; padding:12px; 
    }
    .two-col{ flex-direction:column; gap:16px; margin:20px auto; }
    .col{ 
      width:100% !important; max-width:100% !important; 
      margin:0 auto !important; /* 確保 .col 本身置中 */
      /* 新增 flex 置中，以防萬一 */
      display: flex; 
      justify-content: center;
      align-items: center;
      flex-direction: column;
    }
    .row{ width:100% !important; justify-content:space-between; }
    .planet{ flex:1 1 25%; max-width:25%; }

    /* 關鍵修正：將通用 canvas 樣式複製到手機版，確保覆蓋性 */
    canvas{ 
        max-width:100%; 
        height:auto; 
        display: block; 
        margin: 0 auto; /* 確保 canvas 在 .col 中置中 */
    }

    /* 手機：tooltip 置中且可滾動 */
    #tooltip{
      position: fixed;
      left: 50%; top: 50%;
      transform: translate(-50%,-50%);
      max-width: 92%;
      max-height: 70%;
      overflow-y: auto;
    }
    #tooltip .btn{ display:block; }
  }
</style>
</head>
<body>

<h1>《八大行星》</h1>

<section>
  <h2>公轉與自轉</h2>
  <div class="row glass" id="row"></div>
</section>

<section class="two-col">
  <div class="col glass">
    <h2>公轉與自轉｜速度模擬器</h2>
    <div class="hint">移動滑桿，試著找到『一年比一天還要快的行星是誰?』</div>
    <canvas id="sky1" width="400" height="400"></canvas>

    <div class="control-group">
      <label>公轉速度（慢→快）</label>
      <input type="range" id="orbit" min="0" max="7" step="1" value="5">
      <div class="scale" id="orbitLabels"></div>
    </div>

    <div class="control-group">
      <label>自轉速度（慢→快）</label>
      <input type="range" id="spin" min="0" max="7" step="1" value="3">
      <div class="scale" id="spinLabels"></div>
    </div>

    <div class="info" id="info1"></div>
  </div>

  <div class="col glass">
    <h2>八大行星</h2>
    <div class="hint">桌機：點行星顯示小卡。手機：點行星顯示小卡，點黑幕或按關閉收起。</div>
    <canvas id="sky2" width="500" height="500"></canvas>
  </div>
</section>

<!-- 黑幕與小卡（小卡放黑幕外，避免桌機被隱形） -->
<div id="backdrop"></div>
<div id="tooltip"></div>

<script>
/* ========= 第一段：一排行星 ========= */
const PLANETS = [
  {n:"水星", c:"#b2b2b2", day:1407.6, year:88, size:26},
  {n:"金星", c:"#d6c188", day:5832,   year:225, size:30},
  {n:"地球", c:"#6ec8ff", day:24,     year:365, size:32},
  {n:"火星", c:"#d97b63", day:24.6,   year:687, size:28},
  {n:"木星", c:"#e3b07e", day:9.9,    year:4333, size:46},
  {n:"土星", c:"#e8d6a8", day:10.7,   year:10759, size:42},
  {n:"天王星", c:"#9de4ea", day:17.2, year:30687, size:38},
  {n:"海王星", c:"#6a87ff", day:16.1, year:60190, size:38},
];
const EARTH_DAY_SEC = 2.4, EARTH_YEAR_SEC = 10;

const row = document.getElementById('row');
PLANETS.forEach(p=>{
  const wrap=document.createElement('div'); wrap.className='planet';
  const c1=document.createElement('canvas'); c1.width=110; c1.height=110; p.cSpin=c1;
  const c2=document.createElement('canvas'); c2.width=110; c2.height=60;  p.cOrb=c2;
  const name=document.createElement('div'); name.className='name'; name.textContent=p.n;
  const meta=document.createElement('div'); meta.className='meta'; p.meta=meta;
  wrap.appendChild(c1); wrap.appendChild(c2); wrap.appendChild(name); wrap.appendChild(meta);
  row.appendChild(wrap);
});
function spinOmega(p){const sec=(p.day/24)*EARTH_DAY_SEC; return (2*Math.PI)/(sec*60);}
function orbitOmega(p){const sec=(p.year/365)*EARTH_YEAR_SEC; return (2*Math.PI)/(sec*60);}
function drawRow(){
  PLANETS.forEach(p=>{
    const ctx=p.cSpin.getContext('2d'); ctx.clearRect(0,0,110,110);
    ctx.save(); ctx.translate(55,55);
    p._spin=(p._spin||0)+spinOmega(p);
    ctx.beginPath(); ctx.arc(0,0,p.size,0,Math.PI*2); ctx.fillStyle=p.c; ctx.fill();
    ctx.rotate(p._spin);
    ctx.beginPath(); ctx.arc(p.size*0.6,0,p.size*0.22,0,Math.PI*2); ctx.fillStyle="#fff"; ctx.fill();
    ctx.restore();

    const ctx2=p.cOrb.getContext('2d'); ctx2.clearRect(0,0,110,60);
    ctx2.save(); ctx2.translate(55,30);
    p._orb=(p._orb||0)+orbitOmega(p);
    ctx2.beginPath(); ctx2.ellipse(0,0,42,18,0,0,Math.PI*2);
    ctx2.strokeStyle="rgba(255,255,255,.35)"; ctx2.stroke();
    ctx2.beginPath(); ctx2.arc(0,0,6,0,Math.PI*2); ctx2.fillStyle="yellow"; ctx2.fill();
    const ox=42*Math.cos(p._orb), oy=18*Math.sin(p._orb);
    ctx2.beginPath(); ctx2.arc(ox,oy,4,0,Math.PI*2); ctx2.fillStyle="#fff"; ctx2.fill();
    ctx2.restore();

    p.meta.innerHTML=`一天 ≈ ${p.day} 小時<br>一年 ≈ ${p.year} 地球日`;
  });
  requestAnimationFrame(drawRow);
}
drawRow();

/* ========= 第二段左欄：速度模擬器 ========= */
const canvas1=document.getElementById('sky1'), ctx1=canvas1.getContext('2d');
const spinSlider=document.getElementById('spin'), orbitSlider=document.getElementById('orbit'), info1=document.getElementById('info1');
const rotation=[
  {name:"金星",hours:5832},{name:"水星",hours:1407.6},{name:"火星",hours:24.6},
  {name:"地球",hours:24},{name:"天王星",hours:17.2},{name:"海王星",hours:16.1},
  {name:"土星",hours:10.7},{name:"木星",hours:9.9}
];
const revolution=[
  {name:"海王星",days:60190},{name:"天王星",days:30687},{name:"土星",days:10759},
  {name:"木星",days:4333},{name:"火星",days:687},{name:"地球",days:365},
  {name:"金星",days:225},{name:"水星",days:88}
];
document.getElementById('spinLabels').innerHTML=rotation.map(p=>`<span>${p.name}</span>`).join('');
document.getElementById('orbitLabels').innerHTML=revolution.map(p=>`<span>${p.name}</span>`).join('');
const FPS=60; let spinOmega1=0, orbitOmega1=0; let spinAng=0, orbitAng=0;
function updateSpeeds(){
  const sP=rotation[spinSlider.value], oP=revolution[orbitSlider.value];
  spinOmega1=(2*Math.PI)/((EARTH_DAY_SEC*FPS)*(sP.hours/24));
  orbitOmega1=(2*Math.PI)/((EARTH_YEAR_SEC*FPS)*(oP.days/365));
  info1.innerHTML=`<b>公轉：</b>${oP.name} → ${oP.days} 天 ≈ ${(oP.days/365).toFixed(1)} 地球年<br>
                   <b>自轉：</b>${sP.name} → ${sP.hours} 小時 ≈ ${(sP.hours/24).toFixed(1)} 地球日`;
}
spinSlider.addEventListener('input',updateSpeeds); orbitSlider.addEventListener('input',updateSpeeds); updateSpeeds();
function drawSky1(){
  ctx1.clearRect(0,0,canvas1.width,canvas1.height);
  const cx=canvas1.width/2, cy=canvas1.height/2;
  ctx1.beginPath(); ctx1.arc(cx,cy,30,0,Math.PI*2); ctx1.fillStyle="yellow"; ctx1.fill();
  orbitAng+=orbitOmega1;
  const px=cx+120*Math.cos(orbitAng), py=cy+120*Math.sin(orbitAng);
  ctx1.save(); ctx1.translate(px,py);
  spinAng+=spinOmega1; ctx1.rotate(spinAng);
  ctx1.beginPath(); ctx1.arc(0,0,20,0,Math.PI*2); ctx1.fillStyle="dodgerblue"; ctx1.fill();
  ctx1.beginPath(); ctx1.arc(12,0,5,0,Math.PI*2); ctx1.fillStyle="#fff"; ctx1.fill();
  ctx1.restore();
  requestAnimationFrame(drawSky1);
}
drawSky1();

/* ========= 第二段右欄：八大行星同場展示 ========= */
const canvas2=document.getElementById('sky2'), ctx2=canvas2.getContext('2d');
const tooltip = document.getElementById('tooltip');
const backdrop = document.getElementById('backdrop');

const DATA_RAW = [
  {n:"水星",c:"#b2b2b2",day:1407.6,year:88,r:70,size:6,
   desc:"離太陽最近，表面溫差極大。",
   img:"https://upload.wikimedia.org/wikipedia/commons/4/4a/Mercury_in_true_color.jpg"},
  {n:"金星",c:"#d6c188",day:5832,year:225,r:100,size:9,
   desc:"大氣厚重，溫室效應最強。",
   img:"https://upload.wikimedia.org/wikipedia/commons/e/e5/Venus-real_color.jpg"},
  {n:"地球",c:"#6ec8ff",day:24,year:365,r:130,size:10,
   desc:"人類的家園，唯一已知有生命。",
   img:"https://upload.wikimedia.org/wikipedia/commons/9/97/The_Earth_seen_from_Apollo_17.jpg"},
  {n:"火星",c:"#d97b63",day:24.6,year:687,r:160,size:8,
   desc:"紅色星球，可能曾經有液態水。",
   img:"https://upload.wikimedia.org/wikipedia/commons/0/02/OSIRIS_Mars_true_color.jpg"},
  {n:"木星",c:"#e3b07e",day:9.9,year:4333,r:200,size:16,
   desc:"太陽系最大行星，有大紅斑。",
   img:"https://upload.wikimedia.org/wikipedia/commons/e/e2/Jupiter.jpg"},
  {n:"土星",c:"#e8d6a8",day:10.7,year:10759,r:250,size:14,
   desc:"以壯觀的行星環著名。",
   img:"https://upload.wikimedia.org/wikipedia/commons/c/c7/Saturn_during_Equinox.jpg"},
  {n:"天王星",c:"#9de4ea",day:17.2,year:30687,r:300,size:12,
   desc:"自轉軸幾乎躺平，像滾動的球。",
   img:"https://upload.wikimedia.org/wikipedia/commons/3/3d/Uranus2.jpg"},
  {n:"海王星",c:"#6a87ff",day:16.1,year:60190,r:340,size:12,
   desc:"最外圍行星，風速極高。",
   img:"https://upload.wikimedia.org/wikipedia/commons/5/56/Neptune_Full.jpg"}
];

/* 預抓圖片 */
DATA_RAW.forEach(p=>{ const img=new Image(); img.src=p.img; });

/* 縮放比例 & 初始化 */
const EARTH_DAY = EARTH_DAY_SEC, EARTH_YEAR = EARTH_YEAR_SEC, FPS2 = 60;
const margin = 20;
const maxR = Math.max(...DATA_RAW.map(p=>p.r));
const scale = (canvas2.width/2 - margin) / maxR;

const DATA = DATA_RAW.map(p=>({
  ...p, r: p.r * scale
}));
DATA.forEach(p=>{
  p.orbW=(2*Math.PI)/(((p.year/365)*EARTH_YEAR)*FPS2);
  p.spinW=(2*Math.PI)/(((p.day/24)*EARTH_DAY)*FPS2);
  p.ang=Math.random()*Math.PI*2;
  p.spin=0;
});

function drawSky2(){
  ctx2.clearRect(0,0,canvas2.width,canvas2.height);
  const cx=canvas2.width/2, cy=canvas2.height/2;

  // 太陽
  ctx2.beginPath(); ctx2.arc(cx,cy,30,0,Math.PI*2); ctx2.fillStyle="yellow"; ctx2.fill();

  // 行星
  DATA.forEach(p=>{
    ctx2.beginPath(); ctx2.arc(cx,cy,p.r,0,Math.PI*2);
    ctx2.strokeStyle="rgba(255,255,255,.15)"; ctx2.stroke();

    p.ang+=p.orbW; p.spin+=p.spinW;

    const x=cx+p.r*Math.cos(p.ang), y=cy+p.r*Math.sin(p.ang);
    ctx2.save(); ctx2.translate(x,y);
    ctx2.beginPath(); ctx2.arc(0,0,p.size,0,Math.PI*2); ctx2.fillStyle=p.c; ctx2.fill();
    ctx2.rotate(p.spin);
    ctx2.beginPath(); ctx2.arc(p.size*0.6,0,p.size*0.25,0,Math.PI*2); ctx2.fillStyle="#fff"; ctx2.fill();
    ctx2.restore();

    p.sx=x; p.sy=y;
  });

  requestAnimationFrame(drawSky2);
}
drawSky2();

/* ========= 互動（桌機滑鼠 / 手機點擊） ========= */
let currentHit = null;
const isMobile = window.matchMedia("(max-width: 768px)").matches;
const targetCol = canvas2.parentElement; 
// 新增：追蹤 Tooltip 顯示狀態，以應對手機模式
let isTooltipActive = false; 

/**
 * 根據座標判斷是否點擊到行星
 * [此函數保持不變]
 */
function getHitPlanet(mx, my) {
  for (const p of DATA) {
    // 判斷半徑增加到 15 像素，更容易點擊
    if (Math.hypot(mx - p.sx, my - p.sy) <= p.size + 15) { 
      return p;
    }
  }
  return null;
}

/**
 * 計算目標欄位的中心座標
 * [此函數保持不變]
 */
function getColCenterCoords() {
    const rect = targetCol.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;
    return { centerX, centerY };
}


/**
 * 顯示圖卡
 * [此函數保持不變]
 */
function showTooltip(hit, isClick = false) { 
  tooltip.style.display = "block";

  tooltip.innerHTML = `
    <b>${hit.n}</b>
    一天 ≈ ${hit.day} 小時<br>
    一年 ≈ ${hit.year} 地球日<br>
    <img src="${hit.img}" alt="${hit.n}">
    <span class="desc">${hit.desc}</span>
    <button class="btn" id="closeTip">關閉</button>
  `;

  if (!isMobile && !isClick) { // 桌機懸停邏輯
    tooltip.style.pointerEvents = "none";
    tooltip.style.position = "fixed"; 
    
    const { centerX, centerY } = getColCenterCoords();
    
    tooltip.style.left = centerX + "px";
    tooltip.style.top = centerY + "px";
    tooltip.style.transform = "translate(-50%, -50%)";

  } else { // 手機點擊邏輯
    backdrop.style.display = "block";
    tooltip.style.pointerEvents = "auto";
    tooltip.style.position = "fixed"; 
    
    tooltip.style.left = "50%";
    tooltip.style.top = "50%";
    tooltip.style.transform = "translate(-50%, -50%)";

    const btn = document.getElementById('closeTip');
    btn.addEventListener('click', hideTooltip, { once: true });
  }
}

/**
 * 隱藏圖卡
 * [此函數保持不變]
 */
function hideTooltip() {
  tooltip.style.display = "none";
  backdrop.style.display = "none";
  currentHit = null;
  isTooltipActive = false; // 隱藏時，重設旗標
  // 隱藏時，清除可能殘留的 inline 樣式
  tooltip.style.left = '';
  tooltip.style.top = '';
  tooltip.style.transform = '';
  tooltip.style.position = '';
}

// ------------------------------------------------------------------
// 1. 手機/桌機 **點擊** 事件 (使用 'click' 確保移動端行為穩定)
// ------------------------------------------------------------------
// 這裡同時監聽 pointerdown 和 click，但只有在手機模式下，我們才用 click 來處理邏輯
canvas2.addEventListener("click", e => {
    if (!isMobile) return; // 僅在手機模式下執行點擊邏輯

    const r = canvas2.getBoundingClientRect();
    const mx = e.clientX - r.left, my = e.clientY - r.top;
    let hit = getHitPlanet(mx, my); 

    if (hit) { // A. 點到行星
      e.preventDefault(); 
      
      if (currentHit === hit) {
          // 點擊同一顆行星：關閉
          hideTooltip();
      } else {
          // 點擊新的行星 (或第一次點擊)：開啟
          if (isTooltipActive) hideTooltip(); // 確保先關閉舊的
          
          showTooltip(hit, true);
          currentHit = hit;
          isTooltipActive = true;
      }

    } else { // B. 沒點到行星 (點擊空白處)
      if (isTooltipActive) {
        hideTooltip(); 
      }
    }
});


// ------------------------------------------------------------------
// 2. 桌機滑鼠懸停事件 (Desktop Mouse Hover Event - 僅在非手機模式下啟用)
// ------------------------------------------------------------------
if (!isMobile) {
  canvas2.addEventListener("mousemove", e => {
    const r = canvas2.getBoundingClientRect();
    const mx = e.clientX - r.left, my = e.clientY - r.top;
    let hit = getHitPlanet(mx, my);

    if (hit) {
      if (currentHit !== hit) {
        showTooltip(hit, false); // 懸停事件，isClick=false
        currentHit = hit;
      }
    } else {
      // 移出行星範圍，且當前是懸停模式開啟的圖卡時才隱藏
      if (currentHit && tooltip.style.pointerEvents === 'none') {
          hideTooltip();
      }
    }
  });
  
  // 確保滑鼠移出整個 Canvas 時隱藏 tooltip
  canvas2.addEventListener("mouseleave", hideTooltip);
}

// ------------------------------------------------------------------
// 3. 背景遮罩關閉 (手機模式)
// ------------------------------------------------------------------
// 改用 click 確保穩定性
backdrop.addEventListener("click", hideTooltip); 

// 我們需要一個空的 pointerdown 來阻止手機瀏覽器在觸摸時誤判為捲動或其它行為
canvas2.addEventListener("pointerdown", e => {
  if (isMobile) {
      // 檢查是否點擊到可點擊區域，阻止預設行為
      const r = canvas2.getBoundingClientRect();
      const mx = e.clientX - r.left, my = e.clientY - r.top;
      if (getHitPlanet(mx, my) || isTooltipActive) {
          e.preventDefault(); 
      }
  }
});
</script>
</body>
</html>